# Conference Platform

Распределённая платформа для управления научными конференциями. Система спроектирована как набор независимых компонентов, взаимодействующих по сетевым протоколам: REST API на FastAPI, реляционная СУБД PostgreSQL и S3-совместимое объектное хранилище MinIO.

---

## Архитектура

Система не является монолитом — каждый компонент физически и логически изолирован:

- **Backend (FastAPI)** — вычислительный узел, предоставляющий REST API. Не хранит состояние; все данные передаются в БД или объектное хранилище.
- **PostgreSQL** — сервис хранения структурированных данных. Подключается через SQLAlchemy 2.0 с пулом соединений и проверкой актуальности (`pool_pre_ping`).
- **MinIO (S3)** — объектное хранилище для файлов участников. Взаимодействие через boto3 с подписью `s3v4`, совместимой с современными S3-реализациями.

Конфигурация полностью вынесена в переменные окружения через `pydantic-settings`, что обеспечивает безопасность и переносимость между средами.

---

## Доменная модель

Реализованы следующие сущности предметной области:

**User** — участник платформы. Хранит email, хэш пароля, имя и флаг активности. Является центральной сущностью для аутентификации и участвует во всех ключевых связях системы.

**Role / UserRole** — ролевая модель доступа. Реализовано отношение многие-ко-многим: один пользователь может иметь несколько ролей. Предусмотрены роли `participant`, `org_committee`, `admin`. Удаление роли ограничено (`RESTRICT`) для сохранения целостности данных.

**Conference** — агрегирующая сущность конференции. Содержит название, описание, срок подачи заявок (`submission_deadline`) и флаг активности. Является точкой группировки всех заявок и групп участников.

**Submission** — заявка на участие в конференции. Ключевая операционная сущность: связывает автора и конференцию, хранит название доклада, тезисы и статус (`draft` и далее по жизненному циклу). Поддерживает процесс модерации через поле `status`.

**Group / GroupMember** — логические группы пользователей: оргкомитет, рецензенты и т.д. Реализовано отношение многие-ко-многим между пользователями и группами.

**ConferenceGroup** — связь конференций с группами. Позволяет назначать конкретные группы (например, рецензентов) на конкретные конференции.

---

## Слои приложения

### API (транспортный слой)
Маршрутизаторы FastAPI организованы модульно через `include_router`. Реализованы эндпоинты для работы с файлами: создание S3-бакета при необходимости и потоковая загрузка файлов через `multipart/form-data` без сохранения на диск сервера.

### Services (сервисный слой)
Инкапсулирует взаимодействие с внешней инфраструктурой. Модуль `storage.py` реализует создание и проверку существования бакета, а также потоковую загрузку файлов в MinIO с генерацией уникального `object_key` через UUID.

### Models (доменный слой)
ORM-модели на SQLAlchemy 2.0 с использованием `Mapped` и `mapped_column` — современный декларативный стиль с явной типизацией. Первичные ключи — UUID (кроме справочника ролей).

### Schemas (слой валидации)
Pydantic-схемы формируют контракт между клиентом и сервером. Реализованы схемы для presigned URL: `PresignRequest` (входные данные) и `PresignResponse` (URL, метод, бакет, ключ, TTL).

### DB (инфраструктурный слой)
`Base` — единая точка регистрации всех ORM-моделей для Alembic autogenerate. `get_db()` — dependency injection сессии в рамках жизненного цикла HTTP-запроса.

### Migrations
Alembic с режимом `--autogenerate`. `env.py` динамически подтягивает `DATABASE_URL` из конфигурации приложения — единый источник правды для параметров подключения.

---

## Валидация тезисов

Модуль `app/services/thesis_validation` реализует автоматическую проверку `.docx`-файлов на соответствие требованиям оформления научных тезисов:

- формат страницы A4, поля 20 мм со всех сторон, запрет колонтитулов
- структура заголовочной части: название (ПРОПИСНЫМИ), авторы (курсив, формат «Фамилия И.О.»), организация — все по центру, полужирным, 14 pt Times New Roman
- основной текст: выравнивание по ширине, межстрочный интервал 1.15, абзацный отступ 1.25 см
- наличие блока «Література» в конце документа с нумерованными пунктами
- подписи к рисункам и таблицам оформлены 12 pt
- объём 1–2 страницы (эвристическая оценка по количеству символов)

Результат — объект `ValidationReport` со списком `ValidationIssue`, каждый из которых имеет код, уровень серьёзности (`error` / `warning`) и детали нарушения.

---

## Стек

| Компонент | Технология |
|---|---|
| Backend API | FastAPI 0.115, Python 3.12 |
| ORM | SQLAlchemy 2.0 |
| Миграции | Alembic 1.13 |
| Валидация данных | Pydantic 2 / pydantic-settings |
| Объектное хранилище | boto3, MinIO (S3-совместимое) |
| Работа с .docx | python-docx |
| Контейнеризация | Docker |
| Управление зависимостями | Poetry |
