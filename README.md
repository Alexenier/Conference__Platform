# Conference__Platform


Разрабатываемая система не является монолитным веб-приложением, а проектируется как распределённая платформа, компоненты которой могут функционировать независимо друг от друга в гетерогенной среде.

Распределённость проявляется в архитектурном разделении системы на отдельные логические и инфраструктурные компоненты. Backend-сервис, реализованный на базе FastAPI, выступает как отдельный вычислительный узел, предоставляющий REST API. Система управления базами данных PostgreSQL функционирует как самостоятельный сервис хранения данных, развернутый независимо от API. Для хранения файлов и материалов конференции используется S3-совместимое объектное хранилище, которое также является отдельным инфраструктурным компонентом.

Такое разделение позволяет физически размещать компоненты на разных узлах сети, в разных контейнерах или облачных сервисах. Обмен данными между ними осуществляется по сетевым протоколам, что соответствует принципам построения распределённых систем.

Дополнительно платформа поддерживает работу в гетерогенной среде, поскольку взаимодействие с системой осуществляется через стандартизированный REST-интерфейс. Это позволяет подключать различные типы клиентов — веб-интерфейсы, мобильные приложения или административные панели — независимо от используемых технологий и операционных систем.

Использование ORM SQLAlchemy обеспечивает абстракцию доступа к данным, что повышает переносимость системы и упрощает интеграцию с различными инфраструктурными решениями. Конфигурация через переменные окружения и поддержка контейнеризации дополнительно подтверждают готовность платформы к развёртыванию в распределённой облачной среде.

Таким образом, система соответствует понятию «розподілена платформа», поскольку её компоненты логически и физически разделены, взаимодействуют по сетевым протоколам и могут функционировать в гетерогенном окружении.


## ПАПКА CORE

Папка core содержит централизованную конфигурацию приложения и отвечает за инфраструктурные настройки, которые не относятся к бизнес-логике. Этот слой изолирует технические параметры системы и обеспечивает гибкость при запуске в различных средах — от локальной разработки до production.

В файле config.py реализован класс Settings, наследующийся от BaseSettings. Он описывает основные параметры приложения, включая имя сервиса, режим отладки, строку подключения к базе данных, а также настройки для интеграции с S3-совместимым объектным хранилищем. Конфигурация автоматически загружается из переменных окружения и файла .env, что соответствует современным практикам разработки облачных приложений.

Такой подход обеспечивает строгую типизацию параметров, их валидацию при запуске приложения и безопасное хранение чувствительных данных вне исходного кода. С архитектурной точки зрения core относится к инфраструктурному уровню и служит фундаментом для остальных компонентов системы. 

В файле config.py реализован класс Settings, наследующийся от BaseSettings. Он описывает основные параметры приложения, включая имя сервиса, режим отладки, строку подключения к базе данных, а также настройки для интеграции с S3-совместимым объектным хранилищем. Конфигурация автоматически загружается из переменных окружения и файла .env, что соответствует современным практикам разработки облачных приложений.

Такой подход обеспечивает строгую типизацию параметров, их валидацию при запуске приложения и безопасное хранение чувствительных данных вне исходного кода. С архитектурной точки зрения core относится к инфраструктурному уровню и служит фундаментом для остальных компонентов системы.

## Папка db

Папка db отвечает за инициализацию и управление подключением к базе данных, а также за базовую интеграцию ORM с приложением. Этот слой реализует инфраструктурную часть доступа к данным и изолирует детали работы с СУБД от бизнес-логики и API-уровня.

В файле base.py определяется базовый класс Base, наследующийся от DeclarativeBase. Он используется как единая точка регистрации всех ORM-моделей системы. Каждая модель данных наследуется от этого класса, что позволяет SQLAlchemy формировать метаданные схемы и управлять созданием таблиц. Такой подход соответствует стандартам SQLAlchemy 2.0 и обеспечивает централизованное управление структурой базы данных.

В файле session.py реализована настройка подключения к базе данных через создание engine с использованием строки подключения из конфигурации приложения. Параметр pool_pre_ping=True повышает устойчивость соединения, автоматически проверяя его актуальность перед выполнением запроса, что особенно важно в распределённой и облачной среде.

Далее создаётся фабрика сессий SessionLocal, которая управляет транзакциями и изоляцией операций. Функция get_db() реализует механизм dependency injection и используется в FastAPI для предоставления сессии базы данных в рамках жизненного цикла HTTP-запроса. После завершения обработки запроса соединение корректно закрывается, что предотвращает утечки ресурсов.

С архитектурной точки зрения слой db относится к инфраструктурному уровню и обеспечивает абстрагированный, управляемый и безопасный доступ к данным. Такое разделение позволяет при необходимости изменить механизм хранения данных или параметры подключения без изменения бизнес-логики системы, что соответствует принципам модульности и масштабируемости распределённых платформ.

## Папка api
Папка api реализует HTTP-интерфейс платформы и отвечает за обработку входящих запросов. Этот слой является точкой взаимодействия внешних клиентов с системой и построен на основе FastAPI. Он не содержит бизнес-логики, а выполняет роль транспортного уровня, делегируя операции соответствующим сервисам.

Структурно API организовано через маршрутизаторы (APIRouter), что позволяет логически разделять функциональные модули и масштабировать интерфейс по мере роста системы. Главный агрегирующий маршрутизатор подключает отдельные подмодули через механизм include_router, обеспечивая модульность и расширяемость.

В текущей реализации представлен модуль работы с файлами (files). Он предоставляет REST-эндпоинты для взаимодействия с S3-совместимым объектным хранилищем. Один из маршрутов отвечает за проверку и создание бакета при необходимости, второй — за загрузку файлов через multipart/form-data.

Загрузка реализована асинхронно с использованием UploadFile, что позволяет эффективно работать с потоками данных без полной загрузки файла в память. API-слой принимает файл, передаёт поток в сервисный слой (app.services.storage) и возвращает клиенту информацию о сохранённом объекте, включая имя бакета и ключ объекта.

Обработка исключений осуществляется через HTTPException, что обеспечивает корректные HTTP-ответы при возникновении ошибок инфраструктурного уровня.

С архитектурной точки зрения папка api представляет транспортный слой системы. Она отделена от бизнес-логики и слоя хранения данных, что соответствует принципам чистой архитектуры и делает платформу расширяемой, тестируемой и готовой к работе в гетерогенной распределённой среде.

## Папка Models

Слой models реализует доменную структуру платформы и отражает предметную область управления научными конференциями. Все сущности отображаются на таблицы базы данных через ORM SQLAlchemy и используют UUID в качестве первичных ключей (за исключением справочника ролей). Архитектурно данный слой соответствует доменному уровню системы и отвечает исключительно за описание структуры данных и их связей.

В системе реализованы следующие сущности.

— User
Представляет пользователя платформы. Хранит учетные данные (email, password_hash), информацию профиля и флаг активности. Пользователь является центральной сущностью для аутентификации и авторизации и участвует в связях с ролями, заявками и группами.

— Role
Справочная сущность, описывающая роль пользователя в системе. Используется для реализации модели разграничения доступа. Идентификатор представлен типом SmallInteger, что отражает ограниченный и контролируемый набор ролей.

— UserRole
Связующая таблица для реализации отношения многие-ко-многим между пользователями и ролями. Позволяет одному пользователю иметь несколько ролей и обеспечивает гибкость ролевой модели. Удаление пользователя приводит к каскадному удалению его связей, а удаление роли ограничено для сохранения целостности данных.

— Conference
Описывает научную конференцию как агрегирующую доменную сущность. Содержит название, описание, срок подачи заявок, флаг активности и дату создания. Используется для логической группировки заявок и управления жизненным циклом мероприятия.

— Submission
Ключевая операционная сущность системы. Представляет заявку на участие в конференции. Содержит ссылку на конференцию и автора, название доклада, текст тезисов, статус обработки и временные метки. Поддерживает управление жизненным циклом заявки через поле status, что позволяет реализовать процесс модерации.

— Group
Представляет логическую группу пользователей. Может использоваться для объединения участников, организационных комитетов или рецензентов. Содержит уникальное имя, описание и дату создания.

— GroupMember
Связующая таблица между пользователями и группами. Реализует отношение многие-ко-многим, позволяя одному пользователю состоять в нескольких группах и одной группе включать нескольких пользователей.

— ConferenceGroup
Связующая сущность между конференциями и группами. Позволяет назначать определённые группы пользователей на конкретные конференции, например для формирования организационного комитета или группы рецензентов. Реализует отношение многие-ко-многим между конференциями и группами. 


## Папка schemas

Папка schemas содержит модели валидации и сериализации данных, используемые на уровне API. Данный слой реализован с использованием Pydantic и отвечает за контроль входящих и исходящих данных в HTTP-запросах и ответах. В архитектуре системы он выполняет роль контракта между клиентом и сервером, обеспечивая строгую типизацию и предсказуемую структуру данных.

В текущей реализации представлен модуль file.py, описывающий схемы для работы с предварительно подписанными ссылками на загрузку файлов в S3-совместимое хранилище.

Схема PresignRequest используется для валидации входящих данных при запросе на генерацию presigned URL. Она содержит имя исходного файла и MIME-тип, что позволяет корректно сформировать параметры загрузки.

Схема PresignResponse определяет структуру ответа сервера. В ней описываются URL для загрузки, HTTP-метод, имя бакета, ключ объекта и время действия ссылки. Это обеспечивает клиенту всю необходимую информацию для прямой загрузки файла в объектное хранилище без передачи файла через backend.

Такой подход снижает нагрузку на API-сервис, повышает масштабируемость системы и соответствует архитектуре распределённых платформ, где файловое хранилище функционирует как отдельный инфраструктурный компонент. 


## Папка services
Папка services реализует прикладную бизнес-логику и инкапсулирует взаимодействие с внешними инфраструктурными компонентами. В архитектуре платформы этот слой выступает промежуточным уровнем между API и инфраструктурой, обеспечивая изоляцию технических деталей и повышая тестируемость системы.

В текущей реализации представлен модуль storage.py, отвечающий за интеграцию с S3-совместимым объектным хранилищем через библиотеку Boto3.

Функция _get_s3_client() создаёт и конфигурирует клиента для работы с объектным хранилищем на основе параметров, полученных из конфигурации приложения. Использование версии подписи s3v4 обеспечивает совместимость с современными S3-реализациями, включая MinIO и облачные провайдеры.

Функция ensure_bucket_exists() проверяет существование указанного бакета и при необходимости создаёт его. Это повышает автономность сервиса и упрощает развёртывание в новой среде без предварительной ручной настройки хранилища.

Функция upload_stream() реализует потоковую загрузку файла в объектное хранилище. Генерируется уникальный object_key с использованием UUID, что исключает конфликты имён и соответствует требованиям распределённой среды. Загрузка осуществляется напрямую в S3 без сохранения файла на диск сервера, что повышает производительность и снижает нагрузку на backend.

Архитектурно данный модуль демонстрирует принцип разделения ответственности: API-слой принимает запрос, а слой services выполняет конкретную операцию взаимодействия с внешним сервисом хранения данных. Это делает платформу расширяемой, позволяет при необходимости заменить механизм хранения и соответствует концепции распределённой системы в гетерогенной среде.

## Папка migration

Папка migrations отвечает за управление версионированием структуры базы данных и реализована с использованием Alembic. Этот компонент обеспечивает контролируемое изменение схемы базы данных при развитии проекта и является обязательным элементом production-ориентированной backend-системы.

Файл env.py представляет собой конфигурационный модуль Alembic, который связывает механизм миграций с текущим приложением. В нём подключается конфигурация приложения через settings, импортируются все ORM-модели, а в качестве target_metadata указывается Base.metadata. Это позволяет Alembic автоматически обнаруживать изменения в моделях и генерировать миграции в режиме --autogenerate.

В режиме online подключение к базе данных создаётся динамически с использованием строки подключения из конфигурации приложения. Это обеспечивает единый источник конфигурации и исключает дублирование параметров подключения. В режиме offline миграции могут быть сгенерированы без непосредственного подключения к базе данных, что полезно при подготовке SQL-скриптов.

Архитектурно слой миграций относится к инфраструктурному уровню системы. Он обеспечивает согласованность структуры базы данных с доменной моделью приложения и позволяет безопасно развивать платформу в распределённой среде, поддерживая контроль версий схемы и воспроизводимость развёртывания. 

### Файлы в корне проекта 
В корне проекта размещены файлы, обеспечивающие управление зависимостями, конфигурацией и контейнеризацией приложения.

.gitignore
Определяет файлы и директории, которые не должны попадать в систему контроля версий. Включает временные файлы, кэш Python, локальные конфигурации и .env, что повышает безопасность проекта.

pyproject.toml
Содержит описание проекта и его зависимостей. Используется для управления пакетами и конфигурацией сборки. Позволяет централизованно определять версии библиотек и поддерживать воспроизводимость среды разработки.

alembic.ini
Конфигурационный файл системы миграций Alembic. Определяет параметры подключения и настройки генерации миграций.

Dockerfile
Описывает процесс сборки контейнера приложения. Позволяет упаковать backend-сервис в изолированную среду выполнения, обеспечивая переносимость между различными серверами и облачными платформами.


Определяет многоконтейнерную конфигурацию системы. Обычно включает backend-сервис, базу данных PostgreSQL и объектное хранилище (например, MinIO). Позволяет развернуть распределённую среду разработки одной командой.
